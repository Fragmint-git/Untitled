<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Register - VR Tournament</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="stylesheet" href="css/titlebar.css" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />

  <style>
    html, body {
      margin: 0;
      padding: 0;
      overflow: hidden;
      height: 100%;
    }
  
    body {
      font-family: sans-serif;
      background-color: #1e1e2f;
      color: #fff;
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100vh;
    }
  
    .register-container {
      background-color: #2c2c3c;
      padding: 2rem;
      border-radius: 8px;
      box-shadow: 0 0 15px rgba(0, 0, 0, 0.4);
      width: 500px;
      max-height: 95vh;
      overflow-y: auto;
    }
  
    .register-container h2 {
      text-align: center;
      margin-bottom: 1rem;
    }
  
    .register-container input,
    .register-container select {
      width: 100%;
      padding: 0.5rem;
      border: none;
      border-radius: 4px;
      margin-bottom: 0.5rem;
      box-sizing: border-box;
    }
  
    .register-container button {
      width: 100%;
      padding: 0.5rem;
      margin-top: 1rem;
      background-color: #4caf50;
      border: none;
      border-radius: 4px;
      color: white;
      cursor: pointer;
      font-weight: bold;
    }
  
    .form-row {
      display: flex;
      gap: 10px;
      margin-bottom: 0.5rem;
    }
  
    .form-row input,
    .form-row select {
      flex: 1;
    }
  
    .password-group {
      position: relative;
    }
  
    .password-group i {
      position: absolute;
      top: 50%;
      right: 10px;
      transform: translateY(-50%);
      cursor: pointer;
      color: #999;
    }
  
    .form-row .password-group {
      flex: 1;
      position: relative;
    }
  
    .error-message {
      color: #ff6b6b;
      font-size: 0.9rem;
      text-align: center;
    }
  
    .back-link {
      text-align: center;
      margin-top: 1rem;
      font-size: 0.9rem;
    }
  
    .back-link a {
      color: #4caf50;
      text-decoration: none;
    }
  
    /* Optional: Scrollbar style for overflowing form */
    .register-container::-webkit-scrollbar {
      width: 6px;
    }
  
    .register-container::-webkit-scrollbar-thumb {
      background-color: #4caf50;
      border-radius: 4px;
    }
  </style>
  
</head>
<body>

  <div class="titlebar">
    <div class="titlebar-title">VR Battles App</div>
    <div class="titlebar-controls">
      <button id="minimize-button" class="titlebar-button"><i class="fas fa-window-minimize"></i></button>
      <button id="maximize-button" class="titlebar-button"><i class="fas fa-window-maximize"></i></button>
      <button id="close-button" class="titlebar-button close"><i class="fas fa-times"></i></button>
    </div>
  </div>

  <div class="register-container">
    <h2>Register</h2>
    <form id="registration" enctype="multipart/form-data">

      <div class="form-row">
        <input type="text" name="firstname" id="firstname" placeholder="Firstname" required />
        <input type="text" name="lastname" id="lastname" placeholder="Lastname" required />
      </div>

      <div class="form-row">
        <input type="text" name="username" id="username" placeholder="Username (A-Z, 0-9)" maxlength="20" required />
        <input type="text" name="ign" id="ign" placeholder="In-Game Name (IGN)" maxlength="20" required />
      </div>


      <input type="email" name="email" id="email" placeholder="Email" required />

      <div class="form-row">
        <div class="password-group">
          <input type="password" name="password" id="password" placeholder="Password" required />
          <i id="toggle-password" class="fas fa-eye"></i>
        </div>
        <div class="password-group">
          <input type="password" name="password-confirm" id="confirm-password" placeholder="Confirm Password" required />
          <i id="toggle-confirm-password" class="fas fa-eye"></i>
        </div>
      </div>
  
      <select name="platform" id="platform" required>
        <option value="">Select Platform</option>
        <option value="psvr">PSVR</option>
        <option value="steam">Steam</option>
        <option value="meta">Meta</option>
      </select>
  
      <input type="date" name="birthdate" id="birthdate" placeholder="Birthdate (YYYY-MM-DD)" required />
  
      <select name="country" id="country" required>
        <option value="">Select Country</option>
      </select>
  
      <select name="state" id="state" required>
        <option value="">Select State/Province</option>
      </select>
  
      <select name="region" id="region" required>
        <option value="">Select Region</option>
      </select>
  
      <select name="timezone-select" id="timezone-select" required>
        <option value="">Select Timezone</option>
      </select>
  
      <label for="profile">Profile Image (Max 2MB)</label>
      <input type="file" name="profile" id="profile" accept="image/*" />
  
      <div class="error-message" id="error-message"></div>
  
      <button id="register-button">Register</button>
  
      <div class="back-link">
        Already have an account? <a href="login.html">Login</a>
      </div>
    </form>
  </div>
  
  
  <script src="country-state-region.js"></script>
  <script>
    const passwordInput = document.getElementById('password');
    const confirmPasswordInput = document.getElementById('confirm-password');
    const togglePassword = document.getElementById('toggle-password');
    const toggleConfirmPassword = document.getElementById('toggle-confirm-password');

    togglePassword.addEventListener('click', () => {
    const type = passwordInput.type === 'password' ? 'text' : 'password';
    passwordInput.type = type;
    togglePassword.classList.toggle('fa-eye-slash');
    });

    toggleConfirmPassword.addEventListener('click', () => {
    const type = confirmPasswordInput.type === 'password' ? 'text' : 'password';
    confirmPasswordInput.type = type;
    toggleConfirmPassword.classList.toggle('fa-eye-slash');
    });


    /*document.getElementById('register-button').addEventListener('click', async () => {
      const username = document.getElementById('username').value.trim();
      const email = document.getElementById('email').value.trim();
      const password = document.getElementById('password').value;
      const confirmPassword = document.getElementById('confirm-password').value;
      const errorMessage = document.getElementById('error-message');

      errorMessage.textContent = '';

      if (!username || !email || !password || !confirmPassword) {
        errorMessage.textContent = 'All fields are required.';
        return;
      }

      if (password !== confirmPassword) {
        errorMessage.textContent = 'Passwords do not match.';
        return;
      }

      try {
        const result = await window.api.register({ username, email, password });

        if (result.success) {
          window.api.saveSession(result.user);
          window.location.href = 'index.html';
        } else {
          errorMessage.textContent = result.message || 'Registration failed.';
        }
      } catch (err) {
        console.error(err);
        errorMessage.textContent = 'Server error.';
      }
    });*/

    document.getElementById('register-button').addEventListener('click', async (e) => {
  e.preventDefault();

  const form = document.getElementById('registration');
  const errorMessage = document.getElementById('error-message');
  errorMessage.textContent = '';

  const formData = new FormData(form);

  const user = {
    firstname: formData.get('firstname'),
    lastname: formData.get('lastname'),
    email: formData.get('email'),
    password: formData.get('password'),
    'password-confirm': formData.get('password-confirm'),
    username: formData.get('username'),
    ign: formData.get('ign'),
    platform: formData.get('platform'),
    birthdate: formData.get('birthdate'),
    country: formData.get('country'),
    region: formData.get('region'),
    state: formData.get('state'),
    'timezone-select': formData.get('timezone-select')
  };

  for (const [key, value] of Object.entries(user)) {
    if (!value) {
      errorMessage.textContent = 'Please fill in all required fields.';
      return;
    }
  }

  if (user.password.length < 5) {
    errorMessage.textContent = 'Password must be at least 5 characters long.';
    return;
  }

  if (user.password !== user['password-confirm']) {
    errorMessage.textContent = 'Passwords do not match.';
    return;
  }

  try {
    const formDataToSend = new FormData();
    for (const [key, value] of Object.entries(user)) {
      formDataToSend.append(key, value);
    }

    //const response = await fetch('http://localhost/api/players/register', {
    const response = await fetch('https://www.vrbattles.gg/api/players/register', {
      method: 'POST',
      body: formDataToSend
    });

    const result = await response.json();

    if (response.ok && result.status === 'success') {
      console.log('Registered:', result);
      window.location.href = 'login.html';
    } else {
      errorMessage.textContent = result.message || 'Registration failed.';
    }
  } catch (err) {
    console.error(err);
    errorMessage.textContent = 'Server error.';
  }
});


const countries = {
  "United States": {
    regions: ["East", "West", "Central"],
    states: ["California", "New York", "Texas", "Florida"]
  },
  "Canada": {
    regions: ["Ontario", "Quebec", "British Columbia"],
    states: ["Ontario", "Alberta", "Manitoba"]
  },
  "Philippines": {
    regions: ["NCR", "Luzon", "Visayas", "Mindanao"],
    states: ["Metro Manila", "Cebu", "Davao"]
  }
};

function populateDropdowns() {
  const countrySelect = document.getElementById('country');
  const stateSelect = document.getElementById('state');
  const regionSelect = document.getElementById('region');

  countrySelect.innerHTML = '<option value="">Select Country</option>';
  Object.keys(countries).forEach(country => {
    countrySelect.innerHTML += `<option value="${country}">${country}</option>`;
  });

  countrySelect.addEventListener('change', () => {
    const selectedCountry = countrySelect.value;
    const countryData = countries[selectedCountry];

    stateSelect.innerHTML = '<option value="">Select State/Province</option>';
    regionSelect.innerHTML = '<option value="">Select Region</option>';

    if (countryData) {
      countryData.states.forEach(state => {
        stateSelect.innerHTML += `<option value="${state}">${state}</option>`;
      });
      countryData.regions.forEach(region => {
        regionSelect.innerHTML += `<option value="${region}">${region}</option>`;
      });
    }
  });
}

window.addEventListener('DOMContentLoaded', populateDropdowns);



const timezones = Intl.supportedValuesOf("timeZone") || [];

function loadTimezones() {
  const timezoneSelect = document.getElementById('timezone-select');
  timezoneSelect.innerHTML = '<option value="">Select Timezone</option>';
  timezones.forEach(tz => {
    timezoneSelect.innerHTML += `<option value="${tz}">${tz}</option>`;
  });
}

window.addEventListener('DOMContentLoaded', loadTimezones);


    document.getElementById('minimize-button').addEventListener('click', () => {
      window.api.minimizeWindow();
    });

    document.getElementById('maximize-button').addEventListener('click', () => {
      window.api.maximizeWindow();
    });

    document.getElementById('close-button').addEventListener('click', () => {
      window.api.closeWindow();
    });

    loadTimezones();
  </script>
</body>
</html>
